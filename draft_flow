
void flow() {

    int get_request_header();
    int get_request_data();

    //
    int pending_request_header; // increment this if one complete header received

    int connect_server();       // only do once
    int preprocess_request();   // prepare header to forward

    int forward_request_header();   // only forward if pending_request_header is not 0
    int forward_request_data();

    pending_request_header -= 1;    // only decrement if complete request delivered

    int get_response_header();  
    int get_response_data();

    //
    int pending_response_header;    // increment this if one complete header received

    int preprocess_response();
    int forward_response_header();  // only forward if pending_response_header is not 0
    int forward_response_data();

    pending_request_header -= 1;    // only decrement if complete response delivered

}